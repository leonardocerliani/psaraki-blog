<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="LC">
<meta name="dcterms.date" content="2022-12-26">

<title>LC - How to replace for loops using purrr::map</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../../site_libs/htmlwidgets-1.6.0/htmlwidgets.js"></script>
<link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../site_libs/datatables-binding-0.26/datatables.js"></script>
<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">LC</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">
 <span class="menu-text">blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../apps.html">
 <span class="menu-text">apps</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">
 <span class="menu-text">publications</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#purrrmap" id="toc-purrrmap" class="nav-link" data-scroll-target="#purrrmap"><code>purrr::map</code></a></li>
  <li><a href="#purrrmap2" id="toc-purrrmap2" class="nav-link" data-scroll-target="#purrrmap2"><code>purrr::map2</code></a></li>
  <li><a href="#purrrpmap" id="toc-purrrpmap" class="nav-link" data-scroll-target="#purrrpmap"><code>purrr::pmap</code></a></li>
  <li><a href="#map-is-similar-to-group_by-for-dataframes" id="toc-map-is-similar-to-group_by-for-dataframes" class="nav-link" data-scroll-target="#map-is-similar-to-group_by-for-dataframes"><code>map</code> is similar to <code>group_by</code> for dataframes</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">How to replace for loops using <code>purrr::map</code></h1>
  <div class="quarto-categories">
    <div class="quarto-category">purrr</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>LC </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 26, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In many cases you need to repeat the same action across multiple objects, for instance loading many files, or computing summary statistics across many vectors of observations. Instead of repeating the same operation manually for every object - which is not only time consuming, but especially prone to mistakes - you can use <code>for</code> loops.</p>
<p>However <code>for</code> can be quite verbose, and especially in case you need to nest them - i.e.&nbsp;running a loop inside a loop - it can be difficult to inspect the code for errors during the analysis and especially in the future.</p>
<p>Base R already provides some functions to avoid the creation of <code>for</code> loops, with the <a href="https://www.guru99.com/r-apply-sapply-tapply.html">family of <code>apply</code> functions</a>. However sometimes the syntax can be different across functions, and still a bit verbose.</p>
<p>The <a href="https://www.tidyverse.org/">tidyverse</a> provides functions that help getting rid of <code>for</code> loops for good using the <a href="https://purrr.tidyverse.org/"><code>purrr</code></a> package. Below there is just an example. More details can be found in the <a href="https://r4ds.had.co.nz/iteration.html">iteration chapter of R for Data Science</a> and in the <a href="https://adv-r.hadley.nz/functionals.html">functionals chapter of Advanced R</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s say you collected data in 8 different runs of an experiment. For instance the time, in seconds, spent freezing, running or grooming in 10 participants after a given stimulus in each subsequent run.</p>
<p>For our example we will create some random data. The code below creates 8 dataframes with 10 observations for three distinct variables. It already uses the <code>map</code> function that we are going to explain later, so for now you can just disregard it, and come back later to understand what it does as an excercise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span> <span class="sc">%&gt;%</span> <span class="fu">map</span>( <span class="cf">function</span>(x) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">SUBID =</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"sub_"</span>,.x) ) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">freezing =</span> <span class="fu">runif</span>(<span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span> <span class="sc">*</span> <span class="fu">log</span>(x<span class="sc">+</span><span class="dv">1</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">running =</span> <span class="fu">runif</span>(<span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">grooming =</span> <span class="fu">runif</span>(<span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(<span class="fu">paste0</span>(<span class="st">"run_"</span>,x,<span class="st">".csv"</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We obtain 8 csv files with our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>myfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">".csv"</span>, <span class="at">full.names =</span> T)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>myfiles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "./run_1.csv" "./run_2.csv" "./run_3.csv" "./run_4.csv" "./run_5.csv"
[6] "./run_6.csv" "./run_7.csv" "./run_8.csv"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.csv</span>(<span class="st">"run_1.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    SUBID freezing running grooming
1   sub_1     3.40   0.438      4.1
2   sub_2     6.49   5.871      7.5
3   sub_3     2.95   7.872      6.8
4   sub_4     4.72   0.678      1.4
5   sub_5     2.64   6.816      2.2
6   sub_6     5.28   4.391      7.1
7   sub_7     3.46   0.070      9.9
8   sub_8     0.77   8.778      5.6
9   sub_9     4.78   7.170      8.8
10 sub_10     3.32   0.055      8.9</code></pre>
</div>
</div>
</section>
<section id="purrrmap" class="level2">
<h2 class="anchored" data-anchor-id="purrrmap"><code>purrr::map</code></h2>
<p>Now you want to load everything in the same dataframe (i.e.&nbsp;table), for instance to carry out a RM-ANOVA. You could use a for loop to load all the files:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>allruns <span class="ot">=</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="dv">8</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (run <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(allruns)) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  allruns[[run]] <span class="ot">&lt;-</span> <span class="fu">read.csv</span>( myfiles[[run]] )</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># allruns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or you could use the <code>map</code> function inside the <code>purrr</code> package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>allruns <span class="ot">&lt;-</span> <span class="fu">map</span>(myfiles, read.csv)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># allruns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>In other words you passed to every element of the list <code>myfiles</code> the function <code>read.csv</code></strong></p>
<p>Note the advantages:</p>
<ul>
<li>you do not need to write extra code to initialize an empty list, since the result is automatically stored in a list</li>
<li>you don’t need to provide the total number of files,</li>
<li>the syntax is much more concise (and when you get used to it, also much more readable).</li>
</ul>
</section>
<section id="purrrmap2" class="level2">
<h2 class="anchored" data-anchor-id="purrrmap2"><code>purrr::map2</code></h2>
<p>To carry out the RM-ANOVA, you need to combine all the tables into one singe dataframe, but also retain information about the different run.</p>
<p>The idea is the same as before: you have a function that creates a column with the run numba in each run’s data table. This means that you want to provide <em>two</em> lists: (1) the list containing the table of each run and (2) the list of filenames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>alldata <span class="ot">&lt;-</span> <span class="fu">map2</span>(allruns, myfiles, <span class="cf">function</span>(run, file) run <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">run =</span> file)) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>or with a more concise syntax:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>alldata <span class="ot">&lt;-</span> <span class="fu">map2_df</span>(allruns, myfiles, <span class="sc">~</span> .x <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">run =</span> .y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You might have noticed that here I used a specific flavor of <code>map</code>, that is <code>map_df</code>, which returns a dataframe (or a <code>tibble</code> in the tidyverse language) instead of the default list, so that I can drop the final <code>bind_rows()</code>.</p>
</section>
<section id="purrrpmap" class="level2">
<h2 class="anchored" data-anchor-id="purrrpmap"><code>purrr::pmap</code></h2>
<p>As you might expect, there is also a function <code>pmap</code> which allows you to pass an arbitrary number of tables. I personally prefer this syntax since it allows me to pipe the list into it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>alldata <span class="ot">&lt;-</span> <span class="fu">list</span>(allruns, myfiles) <span class="sc">%&gt;%</span> <span class="fu">pmap_df</span>(<span class="sc">~</span> .x <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">run =</span> .y))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(alldata, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'tp'</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">formatRound</span>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> alldata <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>(), </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits=</span><span class="dv">2</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a0b109ff176439192f80" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a0b109ff176439192f80">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80"],["sub_1","sub_2","sub_3","sub_4","sub_5","sub_6","sub_7","sub_8","sub_9","sub_10","sub_1","sub_2","sub_3","sub_4","sub_5","sub_6","sub_7","sub_8","sub_9","sub_10","sub_1","sub_2","sub_3","sub_4","sub_5","sub_6","sub_7","sub_8","sub_9","sub_10","sub_1","sub_2","sub_3","sub_4","sub_5","sub_6","sub_7","sub_8","sub_9","sub_10","sub_1","sub_2","sub_3","sub_4","sub_5","sub_6","sub_7","sub_8","sub_9","sub_10","sub_1","sub_2","sub_3","sub_4","sub_5","sub_6","sub_7","sub_8","sub_9","sub_10","sub_1","sub_2","sub_3","sub_4","sub_5","sub_6","sub_7","sub_8","sub_9","sub_10","sub_1","sub_2","sub_3","sub_4","sub_5","sub_6","sub_7","sub_8","sub_9","sub_10"],[3.4011366758397,6.48843566521008,2.95305357862275,4.72313499246414,2.64260958757053,5.28381693659369,3.46320431151653,0.76762992140351,4.78162305812257,3.32193009598833,4.60931699748131,4.73326391171503,2.3780904874262,9.22155924703111,2.4678757655644,7.20157356721117,3.83107415200304,5.39614749842688,1.4107097854349,1.72218807095252,13.3672071926749,0.73140349353819,5.00113368536678,2.66062935180229,9.26858089928373,5.26985396211289,6.92890737389861,5.15703646473572,8.73808870615428,12.9575822676658,6.99875967167467,13.3476816769027,12.5989969922192,11.0945696086625,12.5703625129628,12.9274980624316,8.3607395260764,4.32733096614659,14.6530639177375,12.651196107759,6.29756249267378,9.17205870001981,9.30406983058381,7.57343946738848,5.18347254686778,6.36296068024475,2.69746352543783,16.3145325965607,13.1103024281963,10.4823468880355,8.16257045886676,7.08062919590296,12.1670379329826,12.2788755280866,0.742264284307128,7.23429003301195,9.5751240156604,0.487303028990003,4.31123495162188,16.1851220023246,14.7089736880707,12.7755587584854,6.98262667329568,13.0803567024119,17.4592598831391,0.327310096217135,7.90818646010393,6.503266145411,15.3843293289208,2.08264307038201,13.1848790583612,19.5338894664435,15.5312471442609,10.719454830894,12.5433081649459,16.2870363194221,0.78166672808095,15.3203308918419,20.8424835082686,6.9993368451294],[0.4375716811046,5.87079590186477,7.87246332271025,0.677846220787615,6.81601390708238,4.39144222764298,0.0704542803578079,8.77773402025923,7.16952435439453,0.0549250957556069,6.38497195672244,4.73377856425941,2.16355736367404,6.47497531492263,8.20489735808223,9.0271425829269,3.95884178811684,6.91538900369778,9.99414820689708,5.31166377943009,4.42368328105658,1.78596482146531,5.82162475446239,2.29226673021913,7.88041441934183,6.55819539679214,5.09187562158331,0.147801134735346,8.87705173110589,4.73065614700317,0.322225939016789,7.81542438315228,2.43300284259021,2.35191146144643,7.79716263292357,1.7298289318569,5.52685029339045,0.894173085689545,4.80157654266804,4.9727012985386,3.54341879021376,7.91622116230428,2.36667416989803,4.97033288236707,6.29685611464083,8.32186800893396,3.10268935747445,1.16988268913701,2.87186071276665,8.44708358868957,7.11287268670276,3.45186794409528,2.17538298107684,6.68646332575008,6.48250237572938,4.44922719616443,7.76367812184617,8.52135447319597,7.51627895515412,7.38430230179802,5.20411782199517,0.338759822770953,5.85359782679006,4.29134434089065,7.10130726685748,1.93348787957802,3.38800661033019,0.323509217705578,5.06972956703976,3.464972875081,0.0711678084917367,1.66845539119095,0.1814254373312,3.92367530614138,1.98848174419254,7.30559095041826,0.290088520850986,6.9239424308762,4.83490854967386,5.4022579989396],[4.14216229924932,7.54404000937939,6.84020413085818,1.39223169069737,2.24569981219247,7.07554508699104,9.86450841883197,5.63727973494679,8.7632451299578,8.87572611449286,4.29937380831689,5.91079025296494,4.97356124455109,0.634471047669649,3.12642208533362,2.20119341043755,2.333705984056,1.62188650574535,3.1490033864975,7.73923483677208,0.532924584113061,7.1057243924588,6.31663215579465,9.79194186860695,8.77560822060332,5.3903559083119,9.56992176128551,2.52078700112179,7.2629084950313,6.40514291124418,4.72766963299364,2.46861225925386,0.382162700407207,4.32235054671764,3.18276479141787,1.18876566411927,0.672443027142435,5.47039763769135,7.20313180238008,2.94542240444571,8.52044506464154,4.7650606231764,1.51803885120898,0.41994476923719,3.56929210945964,6.74160211812705,7.94196165865287,4.04458222445101,2.31391055276617,4.2486177990213,4.30147458799183,1.52522269869223,7.25970088271424,7.71318293642253,5.07598906522617,3.43861329834908,5.33646534895524,0.961055676452816,3.16922561731189,5.34847740782425,8.70060466229916,5.22588062565774,6.0282482416369,7.16072104871273,4.00613696780056,1.35820852825418,8.75433868495747,8.70206022169441,9.0726479399018,4.56557129044086,4.56447152188048,9.14395817555487,8.71716638328508,1.7132331430912,7.20771770458668,7.86940339254215,8.30311376601458,0.0296343094669282,1.1419628164731,5.33177556470037],["./run_1.csv","./run_1.csv","./run_1.csv","./run_1.csv","./run_1.csv","./run_1.csv","./run_1.csv","./run_1.csv","./run_1.csv","./run_1.csv","./run_2.csv","./run_2.csv","./run_2.csv","./run_2.csv","./run_2.csv","./run_2.csv","./run_2.csv","./run_2.csv","./run_2.csv","./run_2.csv","./run_3.csv","./run_3.csv","./run_3.csv","./run_3.csv","./run_3.csv","./run_3.csv","./run_3.csv","./run_3.csv","./run_3.csv","./run_3.csv","./run_4.csv","./run_4.csv","./run_4.csv","./run_4.csv","./run_4.csv","./run_4.csv","./run_4.csv","./run_4.csv","./run_4.csv","./run_4.csv","./run_5.csv","./run_5.csv","./run_5.csv","./run_5.csv","./run_5.csv","./run_5.csv","./run_5.csv","./run_5.csv","./run_5.csv","./run_5.csv","./run_6.csv","./run_6.csv","./run_6.csv","./run_6.csv","./run_6.csv","./run_6.csv","./run_6.csv","./run_6.csv","./run_6.csv","./run_6.csv","./run_7.csv","./run_7.csv","./run_7.csv","./run_7.csv","./run_7.csv","./run_7.csv","./run_7.csv","./run_7.csv","./run_7.csv","./run_7.csv","./run_8.csv","./run_8.csv","./run_8.csv","./run_8.csv","./run_8.csv","./run_8.csv","./run_8.csv","./run_8.csv","./run_8.csv","./run_8.csv"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>SUBID<\/th>\n      <th>freezing<\/th>\n      <th>running<\/th>\n      <th>grooming<\/th>\n      <th>run<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tp","scrollX":true,"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="map-is-similar-to-group_by-for-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="map-is-similar-to-group_by-for-dataframes"><code>map</code> is similar to <code>group_by</code> for dataframes</h2>
<p>Finally, note that the <code>map</code> function - and its variation, such as <code>pmap</code>, is a similar operator for list to the <code>group_by</code> operator inside dataframes.</p>
<p>For instance let’s say that you want to get the mean and standard deviation for every variable in each run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>descriptives <span class="ot">&lt;-</span> alldata <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(run) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">sd =</span> sd)),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>descriptives <span class="sc">%&gt;%</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped table-hover" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> run </th>
   <th style="text-align:right;"> freezing_mean </th>
   <th style="text-align:right;"> freezing_sd </th>
   <th style="text-align:right;"> running_mean </th>
   <th style="text-align:right;"> running_sd </th>
   <th style="text-align:right;"> grooming_mean </th>
   <th style="text-align:right;"> grooming_sd </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> ./run_1.csv </td>
   <td style="text-align:right;"> 3.8 </td>
   <td style="text-align:right;"> 1.6 </td>
   <td style="text-align:right;"> 4.2 </td>
   <td style="text-align:right;"> 3.5 </td>
   <td style="text-align:right;"> 6.2 </td>
   <td style="text-align:right;"> 2.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ./run_2.csv </td>
   <td style="text-align:right;"> 4.3 </td>
   <td style="text-align:right;"> 2.5 </td>
   <td style="text-align:right;"> 6.3 </td>
   <td style="text-align:right;"> 2.4 </td>
   <td style="text-align:right;"> 3.6 </td>
   <td style="text-align:right;"> 2.1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ./run_3.csv </td>
   <td style="text-align:right;"> 7.0 </td>
   <td style="text-align:right;"> 4.1 </td>
   <td style="text-align:right;"> 4.8 </td>
   <td style="text-align:right;"> 2.7 </td>
   <td style="text-align:right;"> 6.4 </td>
   <td style="text-align:right;"> 3.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ./run_4.csv </td>
   <td style="text-align:right;"> 10.9 </td>
   <td style="text-align:right;"> 3.3 </td>
   <td style="text-align:right;"> 3.9 </td>
   <td style="text-align:right;"> 2.7 </td>
   <td style="text-align:right;"> 3.3 </td>
   <td style="text-align:right;"> 2.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ./run_5.csv </td>
   <td style="text-align:right;"> 8.7 </td>
   <td style="text-align:right;"> 4.0 </td>
   <td style="text-align:right;"> 4.9 </td>
   <td style="text-align:right;"> 2.7 </td>
   <td style="text-align:right;"> 4.4 </td>
   <td style="text-align:right;"> 2.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ./run_6.csv </td>
   <td style="text-align:right;"> 7.8 </td>
   <td style="text-align:right;"> 5.0 </td>
   <td style="text-align:right;"> 6.2 </td>
   <td style="text-align:right;"> 2.1 </td>
   <td style="text-align:right;"> 4.4 </td>
   <td style="text-align:right;"> 2.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ./run_7.csv </td>
   <td style="text-align:right;"> 9.7 </td>
   <td style="text-align:right;"> 5.8 </td>
   <td style="text-align:right;"> 3.7 </td>
   <td style="text-align:right;"> 2.3 </td>
   <td style="text-align:right;"> 6.4 </td>
   <td style="text-align:right;"> 2.6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ./run_8.csv </td>
   <td style="text-align:right;"> 13.2 </td>
   <td style="text-align:right;"> 5.9 </td>
   <td style="text-align:right;"> 3.3 </td>
   <td style="text-align:right;"> 2.8 </td>
   <td style="text-align:right;"> 5.4 </td>
   <td style="text-align:right;"> 3.4 </td>
  </tr>
</tbody>
</table>

</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>